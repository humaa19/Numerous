<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: views/StatisticsView.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: views/StatisticsView.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/**
 * @class Class to help coordinate the view of the statistics menu screen
 */
var StatisticsView = new Class( /** @lends StatisticsView.prototype */ {
	Extends: View,
	
	/**
	 * Controller that controls this view
	 */
	controller: null,
	
	/**
	 * Constructor
	 * @param {Controller} controller control this view
	 */
	initialize: function (controller) {
		
		this.controller = controller;
		
		//Statistics variables to be calculated and displayed
		this.percentComplete = 0;
		this.percent1Star = 0;
		this.percent2Stars = 0;
		this.percent3Stars = 0;
		this.percentAttempted = 0;
		this.percentNotAttempted = 0;
		this.averageAttempts = 0;
		this.averageTime = 0;
		this.maxErrorString = null;
		
	},

	/**
	 * Destructor
	 */
	finalize: function () {
	
	},
	
	/**
	 * Draw the back button
	 */
	drawButtonBack: function() {
		
		var	buttonBack = new Kinetic.Image({image: this.images.buttonBack});
		widgetUtil.glue(buttonBack, {
			width: 0.10,
			height: 0.17,
			dx: 0.05,
			dy: 0.03
		});
		app.layer.add(buttonBack);
		
		buttonBack.on('click tap', function () {
			music.play(app.view.sounds.select);
			app.controller.back();
		});
	},
	
	/**
	 * Draw the buttons for each unit
	 */
	drawUnitButtons: function() {
		
		var unit1Button = new Kinetic.Image({image: this.images.unitLabels[0]});
		widgetUtil.glue(unit1Button, {
			width:0.28,
			height:0.10,
			dx:0.07,
			dy:0.35
		});
		app.layer.add(unit1Button);
		
		unit1Button.on('click tap', function () {
			music.play(app.view.sounds.select);
			app.controller.unitOne();
		});
		
		var unit2Button = new Kinetic.Image({image: this.images.unitLabels[1]});
		widgetUtil.glue(unit2Button, {
			width:0.28,
			height:0.10,
			dx:0.07,
			dy:0.50
		});
		app.layer.add(unit2Button);
		
		unit2Button.on('click tap', function () {
			music.play(app.view.sounds.select);
			app.controller.unitTwo();
		});
		
		var unit3Button = new Kinetic.Image({image: this.images.unitLabels[2]});
		widgetUtil.glue(unit3Button, {
			width:0.28,
			height:0.10,
			dx:0.07,
			dy:0.65
		});
		app.layer.add(unit3Button);
		
		unit3Button.on('click tap', function () {
			music.play(app.view.sounds.select);
			app.controller.unitThree();
		});
		
		var chooseUnitText = new Kinetic.Text({
			x: dimensionUtil.decimalToActualWidth(0.01),
			y: dimensionUtil.decimalToActualHeight(0.25),
			width: dimensionUtil.decimalToActualWidth(0.4 / (1/1024*dimensionUtil.width)),
			scaleX: 1/1024*dimensionUtil.width,
			scaleY: 1/768*dimensionUtil.height,
			text: "Select a Unit",
			fontSize: 40,
			fontFamily: 'mainFont',
			fontStyle: 'bold',
			fill: 'black',
			align: 'center'
		});
		app.layer.add(chooseUnitText);
	},
	
	calculateStatistics: function() {
		
		var starsForLevel;
		var attemptsForLevel;
		var timeForLevel;
		var totalNumberOfGames = 0;
		var unitRecordsModel;
		var numberComplete = 0;
		var numberWith1Star = 0;
		var numberWith2Stars = 0;
		var numberWith3Stars = 0;
		var numberAttempted = 0;
		var totalAttempts = 0;
		var numberNotAttempted = 0;
		var totalTime = 0;
		
		//Retrieving statistics from persistent storage for each unit and level
		for(var i = 0; i &lt; app.UNIT_GAMES.length; i++) {
			unitRecordsModel = new UnitRecordsModel(i);
		
			for (var j=0; j &lt; app.UNIT_GAMES[i].length; j++) {
					
				starsForLevel = unitRecordsModel.getStars(j);
				attemptsForLevel = unitRecordsModel.getAttempts(j);
				timeForLevel = unitRecordsModel.getTime(j);
				
				totalAttempts = totalAttempts + attemptsForLevel;
				totalTime = totalTime + timeForLevel;
				
				switch (starsForLevel) {
					case 0:
						if (attemptsForLevel != 0) {
							numberAttempted++;
						}
						else {
							numberNotAttempted++;
						}
					break;
					case 1:
						numberWith1Star++;
						numberComplete++;
					break;
					case 2:
						numberWith2Stars++;
						numberComplete++;
					break;			
					case 3:
						numberWith3Stars++;
						numberComplete++;
					break;	
				}
				totalNumberOfGames++;
			}
		}
		
		//Calculating overall statistics
		if (numberComplete != 0) {
			this.percentComplete = Math.round((numberComplete/totalNumberOfGames)*100);
			this.percent1Star = Math.round((numberWith1Star/numberComplete)*100);
			this.percent2Stars = Math.round((numberWith2Stars/numberComplete)*100);
			this.percent3Stars =  Math.round((numberWith3Stars/numberComplete)*100);
			this.averageTime = Math.round((totalTime/(numberComplete+numberAttempted)));
			this.averageAttempts = Math.round((totalAttempts/(numberComplete+numberAttempted)));
		}
		
		if (numberAttempted != 0) {
			this.percentAttempted = Math.round((numberAttempted/totalNumberOfGames)*100);
		}
		
		if (numberNotAttempted != 0) {
			this.percentNotAttempted = Math.round((numberNotAttempted/totalNumberOfGames)*100);
		}
		
		
		var errorsForLevel;
		var totalErrors = 0;
		var errorTypes = new Array();
		errorTypes[0] = 0; //dragToTens //Grouping and Addition: 0
		errorTypes[1] = 0; //incorrectDone //Grouping: 1, addition: 4
		errorTypes[2] = 0; //exceededGoalWithEggs //Grouping: 2 
		errorTypes[3] = 0; //packDragToOnes //Grouping: 3, addition: 2
		errorTypes[4] = 0; //exceededGoalWithPacks //Grouping: 4
		errorTypes[5] = 0; //dragEggToHundreds = 0; //Addition: 1
		errorTypes[6] = 0; //dragPackToHundreds = 0; //Addition: 3
		
		//Overall error statistics - excluding practise questions
		for(var i = 0; i &lt; app.UNIT_GAMES.length; i++) {
			unitRecordsModel = new UnitRecordsModel(i);
		
			for (var j=0; j &lt; (app.UNIT_GAMES[i].length - 1); j++) {
				
				errorsForLevel = unitRecordsModel.getErrors(j);
				
				if (errorsForLevel) {
				
					//Errors for grouping games
					if (i == 0 ||  i == 1) {
					
						if (errorsForLevel.search("0") != -1){
							errorTypes[0]++;
							totalErrors++
						}
						if (errorsForLevel.search("1") != -1){
							errorTypes[1]++;
							totalErrors++;
						}
						if (errorsForLevel.search("2") != -1){
							errorTypes[2]++;
							totalErrors++;
						}
						if (errorsForLevel.search("3") != -1){
							errorTypes[3]++;
							totalErrors++;
						}
						if (errorsForLevel.search("4") != -1){
							errorTypes[4]++;
							totalErrors++;
						}
					}
					
					//Errors for addition games
					if (i == 2) {
					
						if (errorsForLevel.search("0") != -1){
							errorTypes[0]++;
							totalErrors++
						}
						if (errorsForLevel.search("1") != -1){
							errorTypes[5]++;
							totalErrors++;
						}
						if (errorsForLevel.search("2") != -1){
							errorTypes[3]++;
							totalErrors++;
						}
						if (errorsForLevel.search("3") != -1){
							errorTypes[6]++;
							totalErrors++;
						}
						if (errorsForLevel.search("4") != -1){
							errorTypes[1]++;
							totalErrors++;
						}
					}
				}
			}
		}
		
		//Finding the most frequent error made overall
		var maxNumberOfErrors = errorTypes[0];
		var	maxErrorType = 0; 	
		for (var i=1; i &lt; errorTypes.length; i++) {
			if (errorTypes[i] > maxNumberOfErrors) {
				maxErrorType = i;
				maxNumberOfErrors = errorTypes[i];
			}
		} 
		
		if (maxNumberOfErrors == 0) {
			this.maxErrorString = "No errors made";
		}
		else if (maxErrorType == 0) {
			this.maxErrorString = "Most frequent error made: Dragging an egg to the tens section";
		}
		else if (maxErrorType == 1) {
			this.maxErrorString = "Most frequent error made: Incorrect number done";
		}
		else if (maxErrorType == 2) {
			this.maxErrorString = "Most frequent error made: Exceeded the goal number with the number of eggs";
		}
		else if (maxErrorType == 3) {
			this.maxErrorString = "Most frequent error made: Dragging an egg to the tens section";
		}
		else if (maxErrorType == 4) {
			this.maxErrorString = "Most frequent error made: Exceeded the goal number with the number of packs";
		}
		else if (maxErrorType == 5) {
			this.maxErrorString = "Most frequent error made: Dragging an egg to the hundreds section";
		}
		else if (maxErrorType == 6) {
			this.maxErrorString = "Most frequent error made: Dragging a pack to the hundreds section";
		}
		
	},
	
	drawStatisticsText: function() {
		
		this.calculateStatistics();
		
		var averageTimeMin = Math.floor(this.averageTime/60000);
		var averageTimeSec = Math.round(((this.averageTime - averageTimeMin*60000)/1000))
		
		//Drawing the blackboard
		var blackBoard = new Kinetic.Image({image: this.images.blackBoard});
		widgetUtil.glue(blackBoard, {
			width: 0.62,
			height: 0.65,
			dx: 0.37,
			dy: 0.20
		});
		
		app.layer.add(blackBoard);
		
		var title = new Kinetic.Text({
			x: dimensionUtil.decimalToActualWidth(0.48),
			y: dimensionUtil.decimalToActualHeight(0.30),
			width: dimensionUtil.decimalToActualWidth(0.4 / (1/1024*dimensionUtil.width)),
			scaleX: 1/1024*dimensionUtil.width,
			scaleY: 1/768*dimensionUtil.height,
			text: "Overall Statistics",
			fontSize: 30,
			fontFamily: 'mainFont',
			fontStyle: 'bold',
			fill: 'white',
			align: 'center'
		});
		
		app.layer.add(title);
		
		//Only displays statistics if there are any to display
		if (this.averageAttempts != 0) {
		
			var completeText = new Kinetic.Text({
				x: dimensionUtil.decimalToActualWidth(0.42),
				y: dimensionUtil.decimalToActualHeight(0.37),
				width: dimensionUtil.decimalToActualWidth(0.4 / (1/1024*dimensionUtil.width)),
				scaleX: 1/1024*dimensionUtil.width,
				scaleY: 1/768*dimensionUtil.height,
				text: this.percentComplete + "% Complete",
				fontSize: 25,
				fontFamily: 'mainFont',
				fill: 'white',
				align: 'left'
			});
			
			app.layer.add(completeText);
			
			var oneStarText = new Kinetic.Text({
				x: dimensionUtil.decimalToActualWidth(0.45),
				y: dimensionUtil.decimalToActualHeight(0.41),
				width: dimensionUtil.decimalToActualWidth(0.4 / (1/1024*dimensionUtil.width)),
				scaleX: 1/1024*dimensionUtil.width,
				scaleY: 1/768*dimensionUtil.height,
				text: this.percent1Star + "% with 1 star",
				fontSize: 25,
				fontFamily: 'mainFont',
				fill: 'white',
				align: 'left'
			});
			
			app.layer.add(oneStarText);
			
			var twoStarsText = new Kinetic.Text({
				x: dimensionUtil.decimalToActualWidth(0.45),
				y: dimensionUtil.decimalToActualHeight(0.45),
				width: dimensionUtil.decimalToActualWidth(0.4 / (1/1024*dimensionUtil.width)),
				scaleX: 1/1024*dimensionUtil.width,
				scaleY: 1/768*dimensionUtil.height,
				text: this.percent2Stars + "% with 2 stars",
				fontSize: 25,
				fontFamily: 'mainFont',
				fill: 'white',
				align: 'left'
			});
			
			app.layer.add(twoStarsText);
			
			var threeStarsText = new Kinetic.Text({
				x: dimensionUtil.decimalToActualWidth(0.45),
				y: dimensionUtil.decimalToActualHeight(0.49),
				width: dimensionUtil.decimalToActualWidth(0.4 / (1/1024*dimensionUtil.width)),
				scaleX: 1/1024*dimensionUtil.width,
				scaleY: 1/768*dimensionUtil.height,
				text: this.percent3Stars + "% with 3 stars",
				fontSize: 25,
				fontFamily: 'mainFont',
				fill: 'white',
				align: 'left'
			});
			
			app.layer.add(threeStarsText);
			
			var attemptsText = new Kinetic.Text({
				x: dimensionUtil.decimalToActualWidth(0.42),
				y: dimensionUtil.decimalToActualHeight(0.56),
				width: dimensionUtil.decimalToActualWidth(0.4 / (1/1024*dimensionUtil.width)),
				scaleX: 1/1024*dimensionUtil.width,
				scaleY: 1/768*dimensionUtil.height,
				text: this.percentAttempted + "% Just attempted",
				fontSize: 25,
				fontFamily: 'mainFont',
				fill: 'white',
				align: 'left'
			});
			
			app.layer.add(attemptsText);
			
			var notAttemptedText = new Kinetic.Text({
				x: dimensionUtil.decimalToActualWidth(0.42),
				y: dimensionUtil.decimalToActualHeight(0.60),
				width: dimensionUtil.decimalToActualWidth(0.4 / (1/1024*dimensionUtil.width)),
				scaleX: 1/1024*dimensionUtil.width,
				scaleY: 1/768*dimensionUtil.height,
				text: this.percentNotAttempted + "% Not attempted",
				fontSize: 25,
				fontFamily: 'mainFont',
				fill: 'white',
				align: 'left'
			});
			
			app.layer.add(notAttemptedText);
			
			var averageAttemptsText = new Kinetic.Text({
				x: dimensionUtil.decimalToActualWidth(0.42),
				y: dimensionUtil.decimalToActualHeight(0.64),
				width: dimensionUtil.decimalToActualWidth(0.4 / (1/1024*dimensionUtil.width)),
				scaleX: 1/1024*dimensionUtil.width,
				scaleY: 1/768*dimensionUtil.height,
				text: "Average no. of attempts: " + this.averageAttempts,
				fontSize: 25,
				fontFamily: 'mainFont',
				fill: 'white',
				align: 'left'
			});
			
			app.layer.add(averageAttemptsText);
			
			var averageTimeText = new Kinetic.Text({
				x: dimensionUtil.decimalToActualWidth(0.68),
				y: dimensionUtil.decimalToActualHeight(0.37),
				width: dimensionUtil.decimalToActualWidth(0.28 / (1/1024*dimensionUtil.width)),
				scaleX: 1/1024*dimensionUtil.width,
				scaleY: 1/768*dimensionUtil.height,
				text: "Average time spent on a level: " + averageTimeMin + " minutes " + averageTimeSec + " seconds",
				fontSize: 25,
				fontFamily: 'mainFont',
				fill: 'white',
				align: 'left'
			});
			
			app.layer.add(averageTimeText);
			
			var maxErrorText = new Kinetic.Text({
				x: dimensionUtil.decimalToActualWidth(0.68),
				y: dimensionUtil.decimalToActualHeight(0.50),
				width: dimensionUtil.decimalToActualWidth(0.28 / (1/1024*dimensionUtil.width)),
				scaleX: 1/1024*dimensionUtil.width,
				scaleY: 1/768*dimensionUtil.height,
				text: this.maxErrorString,
				fontSize: 25,
				fontFamily: 'mainFont',
				fill: 'white',
				align: 'left'
			});
			
			app.layer.add(maxErrorText);
		}
		else {
		
			var noStatisticsText = new Kinetic.Text({
				x: dimensionUtil.decimalToActualWidth(0.48),
				y: dimensionUtil.decimalToActualHeight(0.40),
				width: dimensionUtil.decimalToActualWidth(0.40 / (1/1024*dimensionUtil.width)),
				scaleX: 1/1024*dimensionUtil.width,
				scaleY: 1/768*dimensionUtil.height,
				text: "No statistics to display",
				fontSize: 29,
				fontFamily: 'mainFont',
				fill: 'white',
				align: 'center'
			});
				
			app.layer.add(noStatisticsText);
		
		}
	},
	
});</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="AdditionGameController.html">AdditionGameController</a></li><li><a href="AdditionGameHelper.html">AdditionGameHelper</a></li><li><a href="AdditionGameView.html">AdditionGameView</a></li><li><a href="App.html">App</a></li><li><a href="ArrayUtil.html">ArrayUtil</a></li><li><a href="BrowserMusic.html">BrowserMusic</a></li><li><a href="DimensionUtil.html">DimensionUtil</a></li><li><a href="Env.html">Env</a></li><li><a href="GroupingGame2Controller.html">GroupingGame2Controller</a></li><li><a href="GroupingGame3Controller.html">GroupingGame3Controller</a></li><li><a href="GroupingGameController.html">GroupingGameController</a></li><li><a href="GroupingGameView.html">GroupingGameView</a></li><li><a href="HomeController.html">HomeController</a></li><li><a href="HomeView.html">HomeView</a></li><li><a href="KeyboardTextsGenerator.html">KeyboardTextsGenerator</a></li><li><a href="LoaderUtil.html">LoaderUtil</a></li><li><a href="MathUtil.html">MathUtil</a></li><li><a href="MenuController.html">MenuController</a></li><li><a href="MenuUnitController.html">MenuUnitController</a></li><li><a href="MenuUnitView.html">MenuUnitView</a></li><li><a href="MenuView.html">MenuView</a></li><li><a href="Music.html">Music</a></li><li><a href="OptionsController.html">OptionsController</a></li><li><a href="OptionsView.html">OptionsView</a></li><li><a href="PhonegapMusic.html">PhonegapMusic</a></li><li><a href="Practice1Controller.html">Practice1Controller</a></li><li><a href="Practice2Controller.html">Practice2Controller</a></li><li><a href="Practice3Controller.html">Practice3Controller</a></li><li><a href="PracticeView.html">PracticeView</a></li><li><a href="SpeechUtil.html">SpeechUtil</a></li><li><a href="StatisticsController.html">StatisticsController</a></li><li><a href="StatisticsView.html">StatisticsView</a></li><li><a href="Storage.html">Storage</a></li><li><a href="TemplateController.html">TemplateController</a></li><li><a href="TemplateModel.html">TemplateModel</a></li><li><a href="TemplateView.html">TemplateView</a></li><li><a href="Unit1StatisticsController.html">Unit1StatisticsController</a></li><li><a href="Unit2StatisticsController.html">Unit2StatisticsController</a></li><li><a href="Unit3StatisticsController.html">Unit3StatisticsController</a></li><li><a href="UnitRecordsModel.html">UnitRecordsModel</a></li><li><a href="UnitStatisticsView.html">UnitStatisticsView</a></li><li><a href="View.html">View</a></li><li><a href="WidgetUtil.html">WidgetUtil</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-dev</a> on Wed Feb 05 2014 16:27:14 GMT+1300 (NZDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
